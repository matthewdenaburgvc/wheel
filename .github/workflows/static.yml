name: build and deploy

on:
  push:
    branches:
      - main

  pull_request:
    branches:
      - main
    types:
      - opened
      - reopened
      - synchronize
      - closed

jobs:
  build:
    runs-on: ubuntu-latest
    # skip the build if the PR has been closed
    if: ${{ github.event.action != 'closed' }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Pages
        id: pages
        uses: actions/configure-pages@v5
      - name: Build static content
        run: |
          npm install
          npm run build
      - name: Upload files as artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: dist

  pull_request_deploy:
    runs-on: ubuntu-latest
    # deploy to preview area on pull requests
    if: ${{ github.event_name == 'pull_request' }}

    needs: build
    permissions:
      pages: write
      id-token: write
    environment:
      name: pull-request
      # url: https://${{ github.repository_owner}}.github.io/wheel/pr-preview/${{ github.head_ref }}
    steps:
      - name: Deploy preview
        uses: rossjrw/pr-preview-action@v1
        id: preview-deployment
        with:
          source-dir: dist
          pages-base-path: docs
          # preview-branch: ${{ github.head_ref }}
          umbrella-dir: docs/pr-preview
          comment: false

    # steps:
    #   - name: Deploy to GitHub Pages
    #     id: deployment
    #     uses: actions/deploy-pages@v4

  production_deploy:
    runs-on: ubuntu-latest
    # Only deploy on pushes to the main branch
    # if: ${{ github.event_name == 'push' && github.ref == 'refs/heads/main' }}
    if: false

    needs: build
    permissions:
      pages: write
      id-token: write
    environment:
      name: production
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
